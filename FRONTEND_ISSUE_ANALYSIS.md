# Frontend Generator Loading Issue Analysis

## ğŸš¨ ë¬¸ì œ ìƒí™©
ë¡œê·¸ì¸ í›„ ì„¤ì¹˜ëœ ë°œì „ê¸° ì •ë³´ê°€ í”„ë¡ íŠ¸ì—”ë“œ í™”ë©´ì— í‘œì‹œë˜ì§€ ì•ŠìŒ.
- ë¸Œë¼ìš°ì € ì½˜ì†”ì˜ `loadProgress` ì‘ë‹µì—ëŠ” ì •ìƒì ì¸ ë°œì „ê¸° ë°ì´í„°(10ê°œ)ê°€ í¬í•¨ë˜ì–´ ìˆìŒ.
- ë°±ì—”ë“œ ë¡œê·¸ì—ì„œë„ `GET /progress` ìš”ì²­ì´ 200 OKë¡œ ì„±ê³µí•¨.
- ê·¸ëŸ¬ë‚˜ í™”ë©´ì—ëŠ” ë°œì „ê¸°ê°€ ë³´ì´ì§€ ì•Šê±°ë‚˜ ê°œìˆ˜ê°€ 0ìœ¼ë¡œ í‘œì‹œë¨.

## ğŸ” ì›ì¸ ë¶„ì„

### 1. `generator_types` API í˜¸ì¶œ ì‹¤íŒ¨ (í•µì‹¬ ì›ì¸)
í”„ë¡ íŠ¸ì—”ë“œê°€ ë°œì „ê¸° ë°ì´í„°ë¥¼ í™”ë©´ì— ê·¸ë¦¬ê¸° ìœ„í•´ì„œëŠ” **ë°œì „ê¸° íƒ€ì… ì •ë³´(ë©”íƒ€ë°ì´í„°)**ê°€ í•„ìˆ˜ì ì…ë‹ˆë‹¤.
- ì„œë²„ì—ì„œ ë°›ì€ ë°œì „ê¸° ë°ì´í„°ëŠ” `generator_type_id` (UUID)ë§Œ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ì´ë¥¼ `generatorTypesById` ë§µì„ ì‚¬ìš©í•˜ì—¬ ì´ë¦„, ì´ë¯¸ì§€, ë¹„ìš© ë“±ì˜ ì •ë³´ë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
- **ë¬¸ì œì **: ì‚¬ìš©ìì˜ ë¡œê·¸ë¥¼ ë³´ë©´ `GET /api/generator_types` ìš”ì²­ì´ **500 Internal Server Error**ë¥¼ ë°˜í™˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.
  ```
  https://energytycoon.netlify.app/api/generator_types
  ìƒíƒœ ì½”ë“œ 500 Internal Server Error
  ```
- ì´ë¡œ ì¸í•´ `generatorTypesById`ê°€ ë¹„ì–´ ìˆê²Œ ë˜ê³ , `normalizeServerGenerators` í•¨ìˆ˜ê°€ ë°œì „ê¸° ì •ë³´ë¥¼ ì œëŒ€ë¡œ ë§¤í•‘í•˜ì§€ ëª»í•´ í™”ë©´ì— ë Œë”ë§ë˜ì§€ ì•ŠëŠ” ê²ƒì…ë‹ˆë‹¤.
- **íŠ¹ì´ì‚¬í•­**: ë°±ì—”ë“œ ë¡œê·¸ëŠ” 200 OKë¥¼ ë³´ì´ê³  ìˆì–´, **Netlify Proxy** ê³¼ì •ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤ (ì˜ˆ: í•œê¸€ ì¸ì½”ë”© ë¬¸ì œ, ì‘ë‹µ í¬ê¸° ë“±).

### 2. `App.jsx`ì˜ `fetchAndSyncProgress` ì¡°ê¸° ì¢…ë£Œ (ìš”ì²­ ë¯¸ë°œì†¡ ì›ì¸)
ì‚¬ìš©ì í”¼ë“œë°±ì— ë”°ë¥´ë©´ ë¡œê·¸ì¸ ì‹œ **`progress` ìš”ì²­ ìì²´ê°€ ë„¤íŠ¸ì›Œí¬ íƒ­ì— ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
ì´ëŠ” `App.jsx`ì˜ `fetchAndSyncProgress` í•¨ìˆ˜ì— ìˆëŠ” **í† í° ì²´í¬ ë¡œì§** ë•Œë¬¸ì…ë‹ˆë‹¤.

```javascript
const fetchAndSyncProgress = async (user, token, typeMapById) => {
  if (!user?.user_id) return;
  const safeToken = token || getAuthToken();
  if (!safeToken) return; // <--- ì—¬ê¸°ì„œ í•¨ìˆ˜ê°€ ì¢…ë£Œë¨!
  const res = await loadProgress(user.user_id, safeToken);
  ...
};
```

- **ìƒí™©**: HttpOnly ì¿ í‚¤ ë°©ì‹ì„ ë„ì…í•˜ë©´ì„œ, ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì¿ í‚¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- **ê²°ê³¼**:
  1. `Login.jsx`ëŠ” `token`ìœ¼ë¡œ `null`ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
  2. `getAuthToken()`ë„ ì¿ í‚¤ë¥¼ ì½ì§€ ëª»í•´ `null`ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
  3. `safeToken`ì´ `null`ì´ ë˜ë¯€ë¡œ, **`loadProgress` API í˜¸ì¶œ ì „ì— í•¨ìˆ˜ê°€ ì¢…ë£Œ**ë©ë‹ˆë‹¤.
- **í•´ê²°**: ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ì—ì„œëŠ” í† í° ìœ ë¬´ë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ í™•ì¸í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, **ì´ ì²´í¬ë¥¼ ì œê±°í•˜ê³  ë¬´ì¡°ê±´ ìš”ì²­ì„ ë³´ë‚´ë„ë¡ ìˆ˜ì •**í•´ì•¼ í•©ë‹ˆë‹¤. (ì¸ì¦ ì‹¤íŒ¨ ì‹œ ë°±ì—”ë“œê°€ 401ì„ ë°˜í™˜í•˜ë„ë¡ ìœ„ì„)

### 3. `App.jsx`ì˜ `fetchAndSyncProgress` í˜¸ì¶œ ì¸ì ëˆ„ë½ (ë°ì´í„° ë§¤í•‘ ì‹¤íŒ¨ ì›ì¸)
`Login.jsx`ì—ì„œ `fetchAndSyncProgress`ë¥¼ í˜¸ì¶œí•  ë•Œ 3ë²ˆì§¸ ì¸ì(`typeMapById`)ë¥¼ ì „ë‹¬í•˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤.

### 3. UUID vs Integer ID ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±
`generatorHelpers.js`ì˜ `normalizeServerGenerators` ë¡œì§ì„ ë³´ë©´:
```javascript
const typeIdNum = Number(g.generator_type_id);
const typeInfo = typesById[g.generator_type_id] || typesById[typeIdNum] || {};
```
- ë°±ì—”ë“œëŠ” UUIDë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, í”„ë¡ íŠ¸ì—”ë“œ ì¼ë¶€ ë¡œì§(ë˜ëŠ” ë°ì´í„°)ì´ Integer IDë¥¼ ê¸°ëŒ€í•˜ê±°ë‚˜ í˜¼ìš©í•˜ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í•˜ì§€ë§Œ `generator_types` APIê°€ ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤ë©´ UUID í‚¤ë¡œ ë§¤í•‘ì´ ë˜ì–´ì•¼ í•˜ë¯€ë¡œ, ê·¼ë³¸ ì›ì¸ì€ 1ë²ˆ(API ì‹¤íŒ¨)ì— ìˆìŠµë‹ˆë‹¤.

## ğŸ›  í•´ê²° ë°©í–¥

1.  **`generator_types` 500 ì—ëŸ¬ í•´ê²°**:
    - Netlify Proxy ë¡œê·¸ í™•ì¸ ë˜ëŠ” ë°±ì—”ë“œ ì‘ë‹µ í—¤ë”(Content-Type, Encoding) í™•ì¸.
    - í•œê¸€ ë°ì´í„°ê°€ í¬í•¨ëœ JSON ì‘ë‹µì´ Netlifyì—ì„œ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ”ì§€ í™•ì¸.
2.  **`App.jsx` ìˆ˜ì •**:
    - `onLoginSuccess`ì—ì„œ `fetchAndSyncProgress` í˜¸ì¶œ ì‹œ `useStore.getState().generatorTypesById`ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì „ë‹¬í•˜ê±°ë‚˜, í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìŠ¤í† ì–´ë¥¼ í™•ì‹¤í•˜ê²Œ ì°¸ì¡°í•˜ë„ë¡ ë³´ì¥.
3.  **ë°©ì–´ ì½”ë“œ ì¶”ê°€**:
    - `normalizeServerGenerators`ì—ì„œ ë§¤í•‘ ì‹¤íŒ¨ ì‹œì—ë„ ê¸°ë³¸ê°’(Unknown Generator ë“±)ìœ¼ë¡œ ë Œë”ë§ë˜ë„ë¡ ìˆ˜ì •í•˜ì—¬ ì•„ì˜ˆ ì•ˆ ë³´ì´ëŠ” í˜„ìƒ ë°©ì§€.
