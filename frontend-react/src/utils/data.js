// 공통 상수와 하드코딩된 기본 데이터
import { fromPlainValue } from "./bigValue.js";

const DEPLOY_FRONTEND_URL = "https://energytycoon.netlify.app";
const DEPLOY_BACKEND_URL = "https://energy-tycoon.onrender.com";

function trimTrailingSlash(url) {
  if (!url) return url;
  return url.endsWith("/") ? url.slice(0, -1) : url;
}

export const FRONTEND_BASE = (() => {
  if (window.__FRONTEND_BASE__) return window.__FRONTEND_BASE__;
  const { hostname } = window.location || {};
  const isLocalHost = hostname === "localhost" || hostname === "127.0.0.1";
  if (isLocalHost) return "";
  return trimTrailingSlash(DEPLOY_FRONTEND_URL);
})();

export function toFrontendPath(path) {
  const base = trimTrailingSlash(FRONTEND_BASE);
  return base ? `${base}/${path}` : path;
}

export const API_BASE = (() => {
  if (window.__API_BASE__) return window.__API_BASE__;
  const { protocol, hostname, port } = window.location || {};
  const isLocalHost = hostname === "localhost" || hostname === "127.0.0.1";
  if (isLocalHost || port === "5500") {
    const host = hostname || "127.0.0.1";
    return `http://${host}:8000`;
  }
  // In production, use relative path /api which is proxied by Netlify
  if (protocol === "http:" || protocol === "https:") return "/api";
  return "http://127.0.0.1:8000";
})();

const rawGenerators = [
  {"이름": "식물 광합성 전지", "세부설명": "식물의 광합성을 이용해 소량의 전기를 생산합니다. 낮에만 작동합니다.", "설치비용(수)": 10000, "설치비용(높이)": 0, "설치시간(초)": 3, "생산량(에너지수)": 1000, "생산량(에너지높이)": 0, "크기": 1, "내열한계": 3, "발열": 0},
  {"이름": "소형 태양광 패널(개인용)", "세부설명": "작은 태양광 패널로 태양 에너지를 이용해 전기를 생산합니다.", "설치비용(수)": 250000, "설치비용(높이)": 0, "설치시간(초)": 4, "생산량(에너지수)": 2600, "생산량(에너지높이)": 0, "크기": 2, "내열한계": 10, "발열": 1},
  {"이름": "소형 풍력발전기(마이크로)", "세부설명": "작은 풍력 장치를 이용해 바람으로 전기를 생산합니다.", "설치비용(수)": 100000, "설치비용(높이)": 1, "설치시간(초)": 6, "생산량(에너지수)": 6800, "생산량(에너지높이)": 0, "크기": 2.5, "내열한계": 15, "발열": 1},
  {"이름": "소수력발전기(마을급)", "세부설명": "물을 흐르게 하여 안정적으로 전기를 생산합니다.", "설치비용(수)": 360000, "설치비용(높이)": 1, "설치시간(초)": 9, "생산량(에너지수)": 18000, "생산량(에너지높이)": 0, "크기": 2.2, "내열한계": 25, "발열": 2},
  {"이름": "육상 풍력발전기(일반형)", "세부설명": "육지에서 설치하는 일반적인 풍력 발전기입니다.", "설치비용(수)": 120000, "설치비용(높이)": 2, "설치시간(초)": 13, "생산량(에너지수)": 54000, "생산량(에너지높이)": 0, "크기": 3, "내열한계": 40, "발열": 1},
  {"이름": "부유식 태양광(중형)", "세부설명": "수면 위에 설치된 태양광 패널을 이용해 전력을 생산합니다.", "설치비용(수)": 720000, "설치비용(높이)": 2, "설치시간(초)": 18, "생산량(에너지수)": 150000, "생산량(에너지높이)": 0, "크기": 2.5, "내열한계": 75, "발열": 4},
  {"이름": "파력발전기(해양파)", "세부설명": "해양 파도의 운동 에너지를 이용해 전기를 생산합니다.", "설치비용(수)": 500000, "설치비용(높이)": 3, "설치시간(초)": 24, "생산량(에너지수)": 500000, "생산량(에너지높이)": 0, "크기": 2.3, "내열한계": 112, "발열": 3},
  {"이름": "해상 풍력발전기(대형 터빈)", "세부설명": "해상에서 강한 바람을 이용해 전력을 생산하는 대형 설비입니다.", "설치비용(수)": 310000, "설치비용(높이)": 4, "설치시간(초)": 31, "생산량(에너지수)": 200000, "생산량(에너지높이)": 1, "크기": 3.5, "내열한계": 165, "발열": 3},
  {"이름": "폐열회수 보일러발전기", "세부설명": "산업 공정에서 버려지는 열을 회수하여 전력을 생산합니다.", "설치비용(수)": 200000, "설치비용(높이)": 5, "설치시간(초)": 39, "생산량(에너지수)": 750000, "생산량(에너지높이)": 1, "크기": 2.4, "내열한계": 225, "발열": 8},
  {"이름": "바이오매스 발전기", "세부설명": "유기성 자원을 연소하거나 분해하여 전력을 생산합니다.", "설치비용(수)": 120000, "설치비용(높이)": 6, "설치시간(초)": 48, "생산량(에너지수)": 300000, "생산량(에너지높이)": 2, "크기": 2.1, "내열한계": 295, "발열": 10},
  {"이름": "디젤발전기", "세부설명": "디젤 연료를 사용하여 안정적으로 전력을 생산합니다.", "설치비용(수)": 800000, "설치비용(높이)": 6, "설치시간(초)": 58, "생산량(에너지수)": 100000, "생산량(에너지높이)": 3, "크기": 2.3, "내열한계": 375, "발열": 15},
  {"이름": "조력발전기", "세부설명": "밀물과 썰물의 수위를 이용해 전력을 생산합니다.", "설치비용(수)": 100000, "설치비용(높이)": 8, "설치시간(초)": 69, "생산량(에너지수)": 350000, "생산량(에너지높이)": 3, "크기": 2.5, "내열한계": 425, "발열": 4},
  {"이름": "연료전지 발전기(수소)", "세부설명": "수소와 산소의 화학 반응을 통해 전력을 생산합니다.", "설치비용(수)": 382500, "설치비용(높이)": 8, "설치시간(초)": 81, "생산량(에너지수)": 150000, "생산량(에너지높이)": 4, "크기": 2.7, "내열한계": 625, "발열": 50},
  {"이름": "지열발전기", "세부설명": "지열을 이용하여 안정적이고 지속적인 전력을 생산합니다.", "설치비용(수)": 255500, "설치비용(높이)": 9, "설치시간(초)": 94, "생산량(에너지수)": 400000, "생산량(에너지높이)": 4, "크기": 2.5, "내열한계": 750, "발열": 18},
  {"이름": "가스터빈 발전기", "세부설명": "가스를 연료로 높은 출력의 전력을 생산합니다.", "설치비용(수)": 130000, "설치비용(높이)": 11, "설치시간(초)": 108, "생산량(에너지수)": 225000, "생산량(에너지높이)": 5, "크기": 2.8, "내열한계": 875, "발열": 45},
  {"이름": "수소 가스터빈 발전기", "세부설명": "수소를 연료로 사용하는 친환경 고출력 발전기입니다.", "설치비용(수)": 950000, "설치비용(높이)": 11, "설치시간(초)": 123, "생산량(에너지수)": 215700, "생산량(에너지높이)": 6, "크기": 2.9, "내열한계": 925, "발열": 50},
  {"이름": "수력발전(댐)", "세부설명": "대규모 댐의 낙차를 이용해 전기를 생산합니다.", "설치비용(수)": 800000, "설치비용(높이)": 12, "설치시간(초)": 139, "생산량(에너지수)": 855000, "생산량(에너지높이)": 6, "크기": 3.4, "내열한계": 1024, "발열": 28},
  {"이름": "LNG 복합화력발전기", "세부설명": "LNG를 이용한 고효율 복합 발전 시스템입니다.", "설치비용(수)": 420000, "설치비용(높이)": 13, "설치시간(초)": 156, "생산량(에너지수)": 300000, "생산량(에너지높이)": 7, "크기": 2.7, "내열한계": 1200, "발열": 62},
  {"이름": "석탄 화력발전기", "세부설명": "석탄을 연소하여 대규모 전력을 생산합니다.", "설치비용(수)": 325100, "설치비용(높이)": 15, "설치시간(초)": 174, "생산량(에너지수)": 115000, "생산량(에너지높이)": 8, "크기": 3.4, "내열한계": 1650, "발열": 85},
  {"이름": "원자력 발전기", "세부설명": "핵분열을 이용해 막대한 양의 전력을 생산합니다.", "설치비용(수)": 161500, "설치비용(높이)": 17, "설치시간(초)": 193, "생산량(에너지수)": 200000, "생산량(에너지높이)": 9, "크기": 4, "내열한계": 3250, "발열": 300},
  {"이름": "인공 태양 발전기", "세부설명": "핵융합 기반의 초고출력 에너지를 생산합니다.", "설치비용(수)": 200000, "설치비용(높이)": 22, "설치시간(초)": 213, "생산량(에너지수)": 250000, "생산량(에너지높이)": 10, "크기": 4.3, "내열한계": 5200, "발열": 1200},
  {"이름": "항성 핵 발전기", "세부설명": "작은 항성의 핵 반응을 모사해 고밀도 에너지를 안정적으로 뽑아내는 초고출력 발전기입니다.", "설치비용(수)": 927000, "설치비용(높이)": 25, "설치시간(초)": 234, "생산량(에너지수)": 500000, "생산량(에너지높이)": 11, "크기": 4.5, "내열한계": 6800, "발열": 1800},
  {"이름": "초신성 발전기", "세부설명": "초신성 폭발 에너지를 이용한 가상의 초고출력 발전 장치입니다.", "설치비용(수)": 325000, "설치비용(높이)": 27, "설치시간(초)": 256, "생산량(에너지수)": 420000, "생산량(에너지높이)": 12, "크기": 4.7, "내열한계": 7500, "발열": 2450},
  {"이름": "반물질 발전기", "세부설명": "반물질과 물질의 반응으로 극대한 에너지를 생산합니다.", "설치비용(수)": 175000, "설치비용(높이)": 29, "설치시간(초)": 279, "생산량(에너지수)": 267000, "생산량(에너지높이)": 13, "크기": 4.8, "내열한계": 8750, "발열": 3200},
  {"이름": "양자 진동 발전기", "세부설명": "양자장의 미세한 에너지 흔들림을 포착해 안정적으로 전력으로 변환하는 초고효율 발전기입니다.", "설치비용(수)": 115000, "설치비용(높이)": 31, "설치시간(초)": 303, "생산량(에너지수)": 105000, "생산량(에너지높이)": 15, "크기": 4.9, "내열한계": 9550, "발열": 3850},
  {"이름": "쿼크 응축 발전기", "세부설명": "쿼크-글루온 플라즈마를 초고압으로 안정화해 압도적인 에너지를 추출하는 초고밀도 발전기입니다.", "설치비용(수)": 870000, "설치비용(높이)": 36, "설치시간(초)": 328, "생산량(에너지수)": 472500, "생산량(에너지높이)": 17, "크기": 5.0, "내열한계": 11200, "발열": 4320},
  {"이름": "중력 우물 발전기", "세부설명": "인공적으로 형성한 미세 블랙홀의 강력한 중력 에너지를 끌어내 전력으로 전환하는 초중력 기반 발전기입니다.", "설치비용(수)": 125000, "설치비용(높이)": 41, "설치시간(초)": 354, "생산량(에너지수)": 222200, "생산량(에너지높이)": 19, "크기": 5.2, "내열한계": 12500, "발열": 4750},
  {"이름": "엔트로피 역행 발전기", "세부설명": "무질서도가 감소하는 특이 현상을 역이용해 물리 법칙을 거스르는 막대한 에너지를 생성하는 초엔드급 발전기입니다.", "설치비용(수)": 775000, "설치비용(높이)": 46, "설치시간(초)": 381, "생산량(에너지수)": 655000, "생산량(에너지높이)": 20, "크기": 5.3, "내열한계": 14200, "발열": 5620},
  {"이름": "신성 엔진 발전기", "세부설명": "현실 법칙을 초월한 에너지 원천을 직접 조율해 사실상 무한에 가까운 힘을 발산하는 최종 단계의 초월적 발전기입니다.", "설치비용(수)": 100000, "설치비용(높이)": 1234000, "설치시간(초)": 408, "생산량(에너지수)": 100000, "생산량(에너지높이)": 22, "크기": 5.5, "내열한계": 16500, "발열": 6730},
];

const rawUpgrades = [
  {"이름": "전체 생산량 증가", "endpoint": "production", "field": "production_bonus", "설명": "모든 발전기의 생산량을 늘립니다.", "baseCost": 10, "priceGrowth": 1.8},
  {"이름": "발열 감소", "endpoint": "heat_reduction", "field": "heat_reduction", "설명": "발전기의 발열을 줄입니다.", "baseCost": 50, "priceGrowth": 1.5},
  {"이름": "내열한계 증가", "endpoint": "tolerance", "field": "tolerance_bonus", "설명": "발전기의 내열한계를 높입니다.", "baseCost": 60, "priceGrowth": 2.0},
  {"이름": "최대 발전기 수 증가", "endpoint": "max_generators", "field": "max_generators_bonus", "설명": "설치 가능한 발전기의 최대 수를 늘립니다.", "baseCost": 300, "priceGrowth": 3},
  {"이름": "수요 증가", "endpoint": "demand", "field": "demand_bonus", "설명": "시장 수요를 늘려 교환 가치 하락을 늦춥니다.", "baseCost": 15, "priceGrowth": 2.0}
];

function withResourceFields(obj, key) {
  const v = fromPlainValue(obj[key]);
  return {
    ...obj,
    [`${key}_plain`]: obj[key],
    [`${key}_data`]: v.data,
    [`${key}_high`]: v.high,
  };
}

export const generators = rawGenerators.map((g) => {
  let enriched = withResourceFields(g, "설치비용");
  enriched = withResourceFields(enriched, "생산량(에너지)");
  return enriched;
});

export const upgrades = rawUpgrades.map((u) => {
  const v = fromPlainValue(u.baseCost);
  return { ...u, baseCost_plain: u.baseCost, baseCost_data: v.data, baseCost_high: v.high };
});
